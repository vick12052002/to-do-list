<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="/jQuery/jquery-3.5.1.min.js">
    <link rel="stylesheet" href="style.css">
    <title>To Do List</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    </script>
    <script src="https://kit.fontawesome.com/ea207a6ef9.js" crossorigin="anonymous"></script>
    <script>
        //清空表單的資料
        function reset() {
            $("#title").val("");
            $("input[type='date']").val("");
            $("input[type='file']").val("");
            $("textarea").val("");
            $(".add-task-form").toggle();
        };
        if (localStorage.getItem("item") === null) {
            var toDoList = [];
            localStorage.setItem("item", JSON.stringify(toDoList))
        }
        else {
            var toDoList = JSON.parse(localStorage.getItem("item"));
        };

        function getlist() {
            let arrayJson = JSON.parse(localStorage.getItem("item"));
            if (arrayJson.length !== 0) {
                for (var i = 0; i < arrayJson.length; i++) {
                    getData = arrayJson[i];
                    $(".to-do-list-item").append(`<li class="to-do-item" data-id="${getData['id']}" >
                    <div class="add-task-title row ">
                    <div class="add-task-title-input col-10">
                        <input type="checkbox" name="checkbox" class="css-checkbox" id="${getData['id']}"/>
                        <label for="${getData['id']}" class="css-label"><input type="text" name="${getData['title']}" value="${getData['title']}" class="title-bg"></label>
                    </div>
                    <div class="add-task-title-icon col-2">
                        <label class="far fa-star icon-star icon" style="padding-right: 10px"></label>
                        <label class="fas fa-pen icon-pen icon"></label>
                    </div>
                    <div class="icon-list col " id="${getData['icon']}" >
                    </div>
                </div></li>`);
                    if (getData['date'] !== "") {
                        $("#" + getData['icon']).append(
                            `<i class="far fa-calendar-alt">
                            <span>${getData['date']}</span>
                        </i>`)
                    };
                    if (getData['file'] > 0) {
                        $("#" + getData['icon']).append(
                            ` <i class="far fa-file"></i>`
                        )
                    };
                    if (getData['comment'] !== "") {
                        $("#" + getData['icon']).append(
                            `<i class="far fa-comment-dots">
                        </i>`)
                    };
                };
            }
        }
        function editItem(myId, item) {
            let arrayJson = JSON.parse(localStorage.getItem("item"));
            let myIcon = arrayJson[myId].icon;
            if (item.hasClass("editing") !== true) {
                $(item).addClass("editing").append(
                    `<div class="add-task-item flex-column ">
                <div class="add-task-item-time ">
                    <label for="Deadline subtitle ">
                        <i class="far fa-calendar-alt "></i>
                        <b>Deadline</b>
                    </label>
                    <br>
                    <input type="date" name="date" class="deadline" value="${arrayJson[myId].date}">
                </div>
                <div class="add-task-item-file">
                    <label for="add-file subtitle">
                        <i class="far fa-file"></i>
                        <b>File</b>
                    </label>
                    <br>
                    <span class="add-file">
                        <input type="file" name="file" class="file" style="opacity :0.7;">
                        <span class="file-span">選擇檔案</span>
                    </span>
                </div>
                <div class="add-task-item-comment">
                    <label for="add-comment subtitle ">
                        <i class="far fa-comment-dots"></i>
                        <b>Comment</b>
                    </label>
                    <br>
                    <textarea name="comment" class="form-control" cols="20" rows="3">${arrayJson[myId].comment}</textarea>
                </div>
            </div>
            <div class="add-task-save row">
                <button class="cancel col-6 btn btn-light text-danger">NO &nbsp;Cancel</button>
                <button  class="save col-6 btn btn-primary">+ &nbsp;Save</button>
            </div>`);
            }
            else {
                $(item).children(".add-task-item , .add-task-save").toggle();
            };
            $(document).on ("click",".cancle",function(){
                var item = $(this).parents(".to-do-item");
                $(item).find(".add-task-item, .add-task-save").hide()
                $(item).find(".icon-list").show();
                $(item).children(".add-task-title").removeClass("title-border");
                $(item).find(".icon-pen").removeClass("text-primary");
            });
            $(document).on("click", ".save", function () {
                var item = $(this).parents(".to-do-item");
                var updateObj = {
                    title: $(item).find("input[type='text']").val(),
                    date: $(item).find("input[type='date']").val(),
                    file: $(item).find("input[type='file']").get(0).files.length,
                    comment: $(item).find("textarea").val(),
                    id: myId,
                    icon: myIcon,
                };

                let newArray = [];
                newArray.push(updateObj);
                var updateArray = arrayJson.map(obj => newArray.find(x => x.icon === obj.icon) || obj);
                stringJson = JSON.stringify(updateArray);
                localStorage.setItem('item', stringJson);
                $(item).find(".add-task-item, .add-task-save").hide()
                $(item).find(".icon-list").show();
                $(item).children(".add-task-title").removeClass("title-border");
                $(item).find(".icon-pen").removeClass("text-primary");

            })
        };
        $(document).ready(function () {
            $("button").click((e) => { e.preventDefault() });
            getlist();
            // $(".add-task-form").hide();
            $(".add-task-head").click(function () {
                $(".add-task-form").toggle()
            });

            $(document).on("click", "#save-task", function () {
                var title = $("input[type='text']").val();
                var date = $("input[type='date']").val();
                var file = $("input[type='file']").get(0).files.length;
                var comment = $("textarea").val();
                var dataObj = {
                    title: title,
                    date: date,
                    file: file,
                    comment: comment,
                };
                var id = toDoList.length;
                dataObj["id"] = toDoList.length;
                var icon = "icon" + id;
                dataObj["icon"] = "icon" + id;
                toDoList.push(dataObj);
                stringJson = JSON.stringify(toDoList);
                localStorage.setItem('item', stringJson);

                if (title.length == 0) {
                    alert("type something")
                }
                else {
                    $(".to-do-list-item").append(
                        `<li class="to-do-item" data-id="${id}" >
                    <div class="add-task-title row ">
                    <div class="add-task-title-input col-10">
                        <input type="checkbox" name="checkbox" class="css-checkbox" id="${id}"/>
                        <label for="${id}" class="css-label"><input type="text" name="${title}" value="${title}" class="title-bg"></label>
                    </div>
                    <div class="add-task-title-icon col-2">
                        <label class="far fa-star icon-star icon" style="padding-right: 10px"></label>
                        <label class="fas fa-pen icon-pen icon"></label>
                    </div>
                    <div class="icon-list col " id="${icon}" >
                    </div>
                </div></li>`
                    );
                    if (date !== "") {
                        $("#" + icon).append(
                            `<i class="far fa-calendar-alt">
                            <span>${date}</span>
                        </i>`)
                    };
                    if (file > 0) {
                        $("#" + icon).append(
                            ` <i class="far fa-file"></i>`
                        )
                    };
                    if (comment !== "") {
                        $("#" + icon).append(
                            `<i class="far fa-comment-dots">
                        </i>`)
                    };
                    reset();
                }
            });
            $("#cancel-task").click(() => {
                $(".add-task-form").hide("slow");
            })
            $(document).on("click", ".icon-pen", function () {
                var item = $(this).parents(".to-do-item");
                var myId = item.attr("data-id");
                editItem(myId, item);
                $(item).children(".add-task-title").toggleClass("title-border").children(".icon-list").toggle();
                $(this).toggleClass("text-primary");
                $(this).parents(".add-task-form").children(".add-task-item ,.add-task-save").toggle();
            })
            $(document).on("click", ".icon-star", function () {
                $(this).toggleClass("far").toggleClass("fas").toggleClass("text-warning");
                $(this).parents(".add-task-title").toggleClass("star-bg");

                $(this).parents(".add-task-title-icon").siblings(".add-task-title-input").children(".css-label").children(".title-bg").toggleClass("star-bg");

            })
        });
    </script>
</head>

<body>
    <header>
        <div class="container  text-decoration-none " style="height: 76px ; max-width: 660px; line-height: 71px;">
            <div class="row justify-content-center  text-center h-100 align-middle   ">
                <a id="myTasks" href="" class="col text-decoration-none">My Task</a>
                <a id="inProgress" href="#progress" class="col text-decoration-none">In Progress</a>
                <a id="completed" href="#completed" class="col text-decoration-none">Completed</a>
            </div>
        </div>
    </header>
    <main id="to-do-list" class="to-do-list container w-100" style="max-width: 620px;">
        <div class="add-task-head  w-100 ">
            <i class="fas fa-plus ">Add Task </i>
        </div>
        <form class="add-task-form border rounded text-decoration-none" id="add-task-form
        " onsubmit="mySubmitFunction(e)">
            <div class="add-task-title title-border row  ">
                <div class="add-task-title-input col-10">
                    <input type="checkbox" name="checkbox" class="css-checkbox" />
                    <label for="" class="css-label ">
                        <input type="text" name="title" class="title-bg" id="title"
                            placeholder="Type Something Here"></label>
                </div>
                <div class="add-task-title-icon col-2">
                    <label class="far fa-star icon-star" style="padding-right: 10px;cursor:pointer;"></label>
                    <label class="fas fa-pen icon-pen text-primary" style="cursor:pointer;"></label>
                </div>
            </div>
            <div class="add-task-item">
                <div class="add-task-item-time">
                    <label for="Deadline subtitle ">
                        <i class="far fa-calendar-alt "></i>
                        <b>Deadline</b>
                    </label>
                    <br>
                    <input type="date" name="date" class="Deadline " placeholder="yyyy/mm/dd">
                </div>
                <div class="add-task-item-file">
                    <label for="add-file subtitle ">
                        <i class="far fa-file"></i>
                        <b>File</b>
                    </label>
                    <br>
                    <span class="add-file">
                        <input type="file" name="file" class="file" style="opacity :0.7;">
                        <span class="file-span">選擇檔案</span>
                    </span>
                </div>
                <div class="add-task-item-comment">
                    <label for="add-comment subtitle ">
                        <i class="far fa-comment-dots"></i>
                        <b>Comment</b>
                    </label>21
                    <br>
                    <textarea name="comment" class="form-control" cols="20" rows="3"
                        placeholder="Type your memo here..."></textarea>
                </div>
            </div>
            <div class="add-task-save row">
                <button id="cancel-task" class="col-6 btn btn-light text-danger">NO &nbsp;Cancel</button>
                <button id="save-task" class="col-6 btn btn-primary">+ &nbsp;Save</button>
            </div>
        </form>
        <ul class="to-do-list-item container">
        </ul>

    </main>




    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
</body>

</html>